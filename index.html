<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#004D54">
    <title>2EMME | Prestige Guide</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- SYSTEM VARIABLES --- */
        :root {
            --c-ottanio: #004D54;
            --c-sugar: #BFEBFF;
            --c-white: #FFFFFF;
            --c-magenta: #DB4F61;
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(191, 235, 255, 0.2);
        }

        body { 
            background-color: var(--c-ottanio); color: var(--c-white); 
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Previene rimbalzo su iOS */
            margin: 0; height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* --- BACKGROUNDS --- */
        #bg-container { 
            position: fixed; inset: 0; z-index: -1; 
            background-color: #000; transition: all 1s ease; 
            background-size: cover; background-position: center; 
            opacity: 0.6; filter: brightness(0.8);
        }
        /* Immagini Online garantite */
        .bg-fusion { background-image: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1569683795645-b62e50fbf103?q=80&w=1974'); }
        .bg-boston { background-image: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1505886603762-b94f971887e2?q=80&w=1974'); }
        .bg-nyc { background-image: linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1496442226666-8d4a0e29e128?q=80&w=1974'); }

        /* --- INTRO LAYERS --- */
        #intro-overlay, #bday-overlay {
            position: fixed; inset: 0; z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background-color: #000; transition: opacity 0.8s ease-in-out;
        }
        .hero-title { font-family: 'Playfair Display', serif; font-size: 3.5rem; line-height: 1; color: white; margin-bottom: 10px; text-shadow: 0 4px 20px rgba(0,0,0,0.5); text-align: center;}
        
        /* --- MOBILE LAYOUT --- */
        .app-header { padding: 20px 20px 10px 20px; flex-shrink: 0; z-index: 50; }
        .app-content { flex: 1; overflow-y: auto; padding: 0 20px 100px 20px; scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
        
        /* --- UI COMPONENTS --- */
        .glass-panel { 
            background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); box-shadow: 0 10px 40px rgba(0,0,0,0.3); 
            border-radius: 20px; padding: 20px; margin-bottom: 16px; 
        }
        .glass-icon { 
            display: inline-flex; align-items: center; justify-content: center; 
            width: 40px; height: 40px; border-radius: 12px; flex-shrink: 0;
            background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: var(--c-sugar); 
        }
        
        /* Buttons & Chips */
        .city-switch-container { background: rgba(0,0,0,0.3); border-radius: 99px; padding: 4px; display: flex; margin-bottom: 15px; border: 1px solid var(--glass-border); }
        .city-btn { flex: 1; padding: 12px; border-radius: 99px; font-size: 12px; font-weight: 700; text-transform: uppercase; color: rgba(255,255,255,0.5); transition: 0.3s; }
        .city-btn.active { background: var(--c-sugar); color: var(--c-ottanio); box-shadow: 0 4px 15px rgba(191,235,255,0.3); }

        .cat-chip { 
            padding: 14px; border-radius: 16px; border: 1px solid var(--glass-border); 
            background: rgba(0,0,0,0.2); color: rgba(255,255,255,0.7); 
            font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; 
            width: 100%; transition: 0.2s; touch-action: manipulation;
        }
        .cat-chip:active { transform: scale(0.98); }
        .cat-chip.selected { background: var(--c-sugar); color: var(--c-ottanio); font-weight: 800; border-color: var(--c-sugar); box-shadow: 0 0 20px rgba(191,235,255,0.2); }

        .mode-toggle { display: flex; margin: 15px 0; background: rgba(0,0,0,0.3); border-radius: 99px; padding: 4px; border: 1px solid var(--glass-border); position: relative; }
        .mode-option { flex: 1; text-align: center; padding: 10px; font-size: 11px; font-weight: 700; text-transform: uppercase; z-index: 2; color: rgba(255,255,255,0.6); transition: 0.3s; }
        .mode-option.active { color: var(--c-ottanio); }
        .mode-blob { position: absolute; top: 4px; bottom: 4px; width: calc(50% - 4px); background: var(--c-sugar); border-radius: 99px; transition: left 0.3s; z-index: 1; }

        /* CONTENT STYLES */
        .card-title { font-size: 18px; font-weight: 700; color: white; line-height: 1.2; margin: 0; }
        .card-sub { font-size: 11px; color: var(--c-sugar); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.05em; }
        .card-desc { font-size: 13px; color: #e0e0e0; font-weight: 400; margin: 12px 0; line-height: 1.6; }
        
        .action-btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 10px 16px; border-radius: 12px; font-size: 11px; font-weight: 700; text-transform: uppercase; flex: 1; text-align: center; }
        .btn-primary { background: var(--c-sugar); color: var(--c-ottanio); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .btn-secondary { border: 1px solid var(--c-sugar); color: var(--c-sugar); background: rgba(191,235,255,0.05); }

        /* MUSEUM SPECIFIC */
        .time-btn-container { display: flex; gap: 8px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .time-btn { flex: 1; padding: 10px; border: 1px solid var(--glass-border); border-radius: 10px; font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.7); background: rgba(255,255,255,0.05); transition: 0.2s; }
        .time-btn.active { background: var(--c-sugar); color: var(--c-ottanio); border-color: var(--c-sugar); }
        
        .artwork-list { display: none; margin-top: 15px; animation: fadeIn 0.3s; }
        .artwork-item { display: flex; gap: 12px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .artwork-number { width: 22px; height: 22px; border-radius: 50%; background: var(--c-ottanio); border: 1px solid var(--c-sugar); color: var(--c-sugar); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; flex-shrink: 0; margin-top: 2px; }
        
        /* PLANNER */
        .planner-box { background: rgba(0,0,0,0.2); border-radius: 20px; padding: 20px; border: 1px solid var(--glass-border); }
        .planner-select { width: 100%; background: rgba(255,255,255,0.1); color: white; padding: 14px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.2); outline: none; font-size: 14px; }
        .planner-select option { background: #004D54; color: white; }

        /* TAXI & BDAY */
        #taxi-overlay { position: fixed; inset: 0; background: #000; z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 40px; text-align: center; }
        #taxi-overlay.active { display: flex; animation: fadeIn 0.2s; }
        
        .gold-text { font-family: 'Playfair Display', serif; background: linear-gradient(90deg, #BF953F, #FCF6BA, #B38728, #FBF5B7); -webkit-background-clip: text; color: transparent; animation: shine 3s infinite; }
        
        @keyframes shine { to { background-position: 200% center; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="bg-container"></div>

    <div id="intro-overlay">
        <div class="glass-icon w-20 h-20 rounded-2xl text-4xl mb-6 bg-white/10"><i class="fa-solid fa-gem"></i></div>
        <h1 id="intro-title" class="hero-title">Ciao Giada</h1>
        <p id="intro-sub" class="text-[#BFEBFF] text-sm tracking-[0.3em] uppercase font-bold">Ready for takeoff?</p>
        <button onclick="enterApp()" class="mt-12 px-10 py-4 border border-[#BFEBFF] text-[#BFEBFF] rounded-full uppercase text-xs font-bold tracking-widest hover:bg-[#BFEBFF] hover:text-[#004D54] transition">ENTRA</button>
    </div>

    <div id="bday-overlay">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1550926065-2741979b002c')] bg-cover opacity-60"></div>
        <div id="bottle-scene" class="bottle-container mb-8 relative z-10">
            <i class="fa-solid fa-champagne-glasses text-8xl text-[#FFD700] animate-bounce"></i>
        </div>
        <div class="text-center z-10">
            <p class="text-[#FFD700] text-xs uppercase tracking-widest mb-2">Boston Edition</p>
            <h1 class="gold-text text-9xl font-bold leading-none mb-2">50</h1>
            <h2 class="text-3xl text-white font-serif italic">Happy Birthday!</h2>
            <button onclick="closeBday()" class="mt-10 px-8 py-3 bg-gradient-to-r from-[#BF953F] to-[#FCF6BA] text-black font-bold rounded-full shadow-lg">Grazie! ðŸ¥‚</button>
        </div>
    </div>

    <div id="main-app" class="h-full flex flex-col hidden opacity-0 transition-opacity duration-500">
        
        <div class="app-header">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3" onclick="triggerBday()">
                    <div class="glass-icon bg-[#00383D]"><i class="fa-solid fa-gem"></i></div>
                    <div><h1 class="text-xl font-bold text-white leading-none">2EMME</h1><p class="text-[#BFEBFF] text-[9px] uppercase tracking-widest mt-1">Travel Master</p></div>
                </div>
                <button onclick="toggleMeteo()" class="glass-icon w-auto px-4 h-9 gap-2 text-xs font-bold border-white/20"><i class="fa-regular fa-snowflake"></i> <span id="meteo-txt">Neve</span></button>
            </div>
            
            <div class="city-switch-container">
                <button onclick="setCity('nyc')" id="btn-nyc" class="city-btn active">New York</button>
                <button onclick="setCity('boston')" id="btn-boston" class="city-btn">Boston</button>
            </div>
        </div>

        <div class="app-content no-scrollbar">
            
            <div class="grid grid-cols-2 gap-2 mb-4">
                <button onclick="setCat('planner')" id="cat-planner" class="cat-chip col-span-2 justify-center bg-[#004D54] border-[#BFEBFF] text-[#BFEBFF]"><i class="fa-solid fa-bell-concierge"></i> Concierge Planner</button>
                <button onclick="setCat('explore')" id="cat-explore" class="cat-chip"><i class="fa-solid fa-compass"></i> Esplora</button>
                <button onclick="setCat('food')" id="cat-food" class="cat-chip"><i class="fa-solid fa-utensils"></i> Food</button>
                <button onclick="setCat('shopping')" id="cat-shopping" class="cat-chip"><i class="fa-solid fa-bag-shopping"></i> Shopping</button>
                <button onclick="setCat('tips')" id="cat-tips" class="cat-chip"><i class="fa-solid fa-kit-medical"></i> Survival</button>
                <button onclick="setCat('hotel')" id="cat-hotel" class="cat-chip"><i class="fa-solid fa-bed"></i> Hotel</button>
                <button onclick="setCat('local')" id="cat-local" class="cat-chip"><i class="fa-solid fa-user-secret"></i> Local</button>
            </div>

            <div id="mode-control" class="mode-toggle" style="display:none;">
                <div id="mode-blob" class="mode-blob left-1"></div>
                <button onclick="setMode('classic')" id="opt-classic" class="mode-option active">Refined Classics</button>
                <button onclick="setMode('niche')" id="opt-niche" class="mode-option">New & Niche</button>
            </div>

            <div id="feed" class="space-y-4"></div>
        </div>
    </div>

    <div id="taxi-overlay" onclick="closeTaxi()">
        <p class="text-[#BFEBFF] text-xs uppercase tracking-widest mb-10">Show to Driver</p>
        <h1 id="taxi-name" class="text-4xl font-bold text-white mb-6 px-4 leading-tight">NAME</h1>
        <div class="bg-white text-black p-6 rounded-2xl w-full max-w-xs shadow-2xl">
            <p id="taxi-address" class="text-2xl font-mono font-bold leading-relaxed">Address Here</p>
        </div>
        <p class="text-xs text-gray-500 mt-20 animate-pulse">(Tocca per chiudere)</p>
    </div>

    <script>
        const CONFIG = { forceBday: false };
        
        // --- DATABASE ---
        const museumRoutes = {
            60: { '2h': [{t:'Notte Stellata', a:'Van Gogh', d:'Piano 5, Sala 502.'}, {t:'Les Demoiselles', a:'Picasso', d:'Inizio Cubismo.'}, {t:'Ninfee', a:'Monet', d:'Sala immersiva.'}], '3h': [{t:'Number 31', a:'Pollock', d:'Piano 4.'}, {t:'Soup Cans', a:'Warhol', d:'Icona Pop Art.'}], '4h': [{t:'Design Store', a:'Shopping', d:'Imperdibile.'}] },
            70: { '2h': [{t:'Il Cortile', a:'Architettura', d:'Fiori freschi.'}, {t:'Ratto di Europa', a:'Tiziano', d:'Sala Tiziano.'}], '3h': [{t:'Sala Olandese', a:'Rembrandt', d:'Cornici vuote dei furti.'}], '4h': [{t:'Serra', a:'Natura', d:'Coltivazione fiori.'}] },
            61: { '2h': [{t:'Biblioteca Est', a:'J.P. Morgan', d:'Tre piani di libri.'}, {t:'Studio', a:'Storia', d:'Velluto rosso.'}], '3h': [{t:'Bibbia Gutenberg', a:'Libro', d:'Rarissimo.'}], '4h': [{t:'Mostra Temporanea', a:'Info', d:'Controlla sito.'}] },
            63: { '2h': [{t:'T-Rex', a:'Fossile', d:'Piano 4.'}, {t:'Balena Blu', a:'Modello', d:'Ocean Life.'}], '3h': [{t:'Lucy', a:'Antenato', d:'Origini umane.'}], '4h': [{t:'Planetario', a:'Space Show', d:'Biglietto extra.'}] },
            64: { '2h': [{t:'Space Shuttle', a:'Enterprise', d:'Padiglione ponte.'}, {t:'Concorde', a:'Aereo', d:'Record velocitÃ .'}], '3h': [{t:'Sottomarino', a:'Growler', d:'Interni missili.'}], '4h': [{t:'Simulatore', a:'G-Force', d:'Esperienza volo.'}] }
        };

        const db = [
            // TIPS
            { id:1, city:'nyc', cat:'tips', name:'Consolato Italiano NYC', desc:'690 Park Ave. In caso di furto passaporto.', icon:'fa-passport', phone:'+12127379100', address:'690 Park Ave', action:'Chiama', isAlert:true },
            { id:2, city:'nyc', cat:'tips', name:'NYU Langone Hospital', desc:'Kips Bay. Pronto Soccorso H24 sicuro.', icon:'fa-hospital', address:'550 1st Ave', action:'Mappa', isAlert:true },
            { id:4, city:'nyc', cat:'tips', name:'Regole Metro', desc:'â€¢ Uptown=Nord, Downtown=Sud.\nâ€¢ Mai entrare in un vagone vuoto.', icon:'fa-train-subway', action:'' },
            { id:5, city:'nyc', cat:'tips', name:'Rifugio Caldo', desc:'Oculus & Brookfield. Tunnel riscaldati.', icon:'fa-mug-hot', address:'185 Greenwich St', action:'Mappa' },
            { id:6, city:'boston', cat:'tips', name:'Consolato Italiano BOS', desc:'600 Atlantic Ave.', icon:'fa-passport', phone:'+16177229201', address:'600 Atlantic Ave', action:'Chiama', isAlert:true },
            { id:7, city:'boston', cat:'tips', name:'Mass General (MGH)', desc:'Ospedale #1. Beacon Hill.', icon:'fa-hospital', address:'55 Fruit St', action:'Mappa', isAlert:true },
            { id:10, city:'boston', cat:'tips', name:'Rifugio Caldo', desc:'Prudential Center.', icon:'fa-snowflake', address:'800 Boylston St', action:'Mappa' },

            // MUSEI
            { id:60, city:'nyc', cat:'explore', mode:'classic', name:'MoMA', address:'11 W 53rd St', desc:'Arte moderna.', icon:'fa-paint-brush', hasRoutes:true },
            { id:61, city:'nyc', cat:'explore', mode:'classic', name:'Morgan Library', address:'225 Madison', desc:'Biblioteca storica.', icon:'fa-book-open', hasRoutes:true },
            { id:63, city:'nyc', cat:'explore', mode:'classic', name:'Natural History', address:'Central Park W', desc:'Dinosauri.', icon:'fa-dragon', hasRoutes:true },
            { id:64, city:'nyc', cat:'explore', mode:'niche', name:'Intrepid Museum', address:'Pier 86', desc:'Portaerei.', icon:'fa-jet-fighter', hasRoutes:true },
            { id:70, city:'boston', cat:'explore', mode:'classic', name:'Gardner Museum', address:'25 Evans Way', desc:'Cortile fiorito.', icon:'fa-leaf', hasRoutes:true },
            { id:72, city:'boston', cat:'explore', mode:'classic', name:'MFA', address:'465 Huntington', desc:'Museo d\'Arte.', icon:'fa-landmark', hasRoutes:true },
            { id:73, city:'boston', cat:'explore', mode:'classic', name:'JFK Library', address:'Columbia Point', desc:'Storia JFK.', icon:'fa-flag-usa' },
            { id:75, city:'boston', cat:'explore', mode:'niche', name:'MIT Museum', address:'314 Main St', desc:'Robotica e AI.', icon:'fa-robot' },

            // SHOPPING
            { id:100, city:'nyc', cat:'shopping', mode:'classic', name:'Fishs Eddy', address:'889 Broadway', desc:'Piatti skyline NY.', icon:'fa-kitchen-set', action:'Mappa' },
            { id:101, city:'nyc', cat:'shopping', mode:'classic', name:'Strand Bookstore', address:'828 Broadway', desc:'Libreria 18 miles.', icon:'fa-book', action:'Mappa' },
            { id:103, city:'nyc', cat:'shopping', mode:'niche', name:'Dover Street Market', address:'160 Lexington', desc:'Moda avanguardia.', icon:'fa-shirt', action:'Mappa' },
            { id:106, city:'boston', cat:'shopping', mode:'classic', name:'Black Ink', address:'101 Charles St', desc:'Oggetti curiosi.', icon:'fa-pen-nib', action:'Mappa' },
            { id:109, city:'boston', cat:'shopping', mode:'niche', name:'Bodega', address:'6 Clearway St', desc:'Sneaker shop segreto.', icon:'fa-user-secret', action:'Mappa' },

            // FOOD
            { id:11, city:'nyc', cat:'food', mode:'classic', name:'Carbone', zone:'Village', desc:'Italiano Iconico.', dish:'Spicy Rigatoni', cost:'$100+', icon:'fa-utensils', link:'https://resy.com' },
            { id:13, city:'nyc', cat:'food', mode:'classic', name:'Keens Steak', zone:'Midtown', desc:'Storica (1885).', dish:'Mutton Chop', cost:'$90', icon:'fa-drumstick-bite', link:'https://resy.com' },
            { id:16, city:'nyc', cat:'food', mode:'niche', name:'Laser Wolf', zone:'Brooklyn', desc:'Israeliano Rooftop.', dish:'Salatim', cost:'$70', icon:'fa-fire', link:'https://resy.com' },
            { id:30, city:'boston', cat:'food', mode:'classic', name:'Contessa', zone:'Back Bay', desc:'Rooftop Vetrato.', dish:'Lobster Rigatoni', cost:'$90', icon:'fa-city', link:'https://opentable.com' },
            { id:31, city:'boston', cat:'food', mode:'classic', name:'Union Oyster', zone:'North End', desc:'Antico (1826).', dish:'Clam Chowder', cost:'$50', icon:'fa-fish', link:'https://opentable.com' },
            { id:35, city:'boston', cat:'food', mode:'niche', name:'Mikiya Wagyu', zone:'Chinatown', desc:'Shabu Lusso.', dish:'Wagyu', cost:'$98', icon:'fa-fire-burner', link:'#' },

            // HOTELS
            { id:20, city:'nyc', cat:'hotel', mode:'classic', name:'The Plaza', desc:'Icona.', price:'$$$$', icon:'fa-hotel' },
            { id:25, city:'nyc', cat:'hotel', mode:'niche', name:'The Ludlow', desc:'Cool vibes.', price:'$$$', icon:'fa-bath' }
        ];

        let state = { city:'nyc', cat:'planner', mode:'classic', weather:'snow' };

        // INITIALIZATION
        function enterApp() {
            document.getElementById('intro-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro-overlay').style.display = 'none';
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('main-app').style.opacity = '1';
                updateUI();
            }, 800);
        }

        window.onload = function() {
            const date = new Date();
            const month = date.getMonth(); 
            const day = date.getDate();
            const bg = document.getElementById('bg-container');
            const title = document.getElementById('intro-title');
            const sub = document.getElementById('intro-sub');

            if(month === 1) { 
                if(day < 4) { bg.className = 'bg-fusion'; title.innerText = "Ciao Giada"; } 
                else if (day >= 4 && day < 7) { bg.className = 'bg-boston'; title.innerText = "Benvenuta a Boston"; state.city = 'boston'; } 
                else if (day >= 7) { bg.className = 'bg-nyc'; title.innerText = "Benvenuta a NYC"; state.city = 'nyc'; }
            } else { bg.className = 'bg-fusion'; }

            if(CONFIG.forceBday || (month === 1 && day === 6)) {
                document.getElementById('intro-overlay').style.display='none';
                triggerBday();
            }
        };

        // FUNCTIONS
        function setCity(c) { state.city = c; updateUI(); }
        function setCat(c) { state.cat = c; updateUI(); }
        function setMode(m) { state.mode = m; updateUI(); }
        
        function triggerBday() { document.getElementById('bday-overlay').style.display = 'flex'; }
        function closeBday() {
            document.getElementById('bday-overlay').style.display = 'none';
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('main-app').style.opacity = '1';
            updateUI();
        }

        function showRoute(id, time) {
            const listDiv = document.getElementById(`list-${id}`);
            const data = museumRoutes[id];
            
            document.querySelectorAll(`#card-${id} .time-btn`).forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            if(!data || !data[time]) return;

            let html = '';
            let items = data[time];
            if(time === '3h' && data['2h']) items = [...data['2h'], ...data['3h']];
            if(time === '4h') { items = [...data['2h']||[], ...data['3h']||[], ...data['4h']]; }
            
            items.forEach((item, idx) => {
                html += `<div class="artwork-item"><div class="artwork-number">${idx+1}</div><div class="text-white text-xs"><strong>${item.t}</strong> (${item.a})<br><span class="text-gray-400">${item.d}</span></div></div>`;
            });
            listDiv.innerHTML = html;
            listDiv.style.display = 'block';
        }

        function generatePlan() {
            const mId = parseInt(document.getElementById('planner-museum').value);
            const item = db.find(i=>i.id===mId);
            const food = db.find(i=>i.cat==='food' && i.city===state.city && i.zone===item.zone) || db.find(i=>i.cat==='food' && i.city===state.city);
            
            document.getElementById('planner-res').innerHTML = `
                <div class="mt-4 border-l-2 border-[#BFEBFF] pl-4 animate-pulse">
                    <p class="text-xs text-[#BFEBFF]">ITINERARIO SUGGERITO</p>
                    <p class="text-white font-bold text-lg mb-1">${item.name}</p>
                    <p class="text-xs text-gray-400 mb-3">Visita la collezione principale.</p>
                    <p class="text-xs text-[#BFEBFF]">LUNCH VICINO (${item.zone || 'Zona'})</p>
                    <div class="bg-white/10 p-3 rounded-xl flex items-center gap-3 mt-1">
                        <i class="fa-solid ${food.icon} text-[#BFEBFF]"></i>
                        <div><p class="font-bold text-white text-sm">${food.name}</p><p class="text-xs text-gray-400">${food.dish}</p></div>
                    </div>
                </div>`;
        }

        function updateUI() {
            document.getElementById('btn-nyc').className = state.city === 'nyc' ? 'city-btn active' : 'city-btn';
            document.getElementById('btn-boston').className = state.city === 'boston' ? 'city-btn active' : 'city-btn';
            
            document.querySelectorAll('.cat-chip').forEach(b => b.classList.remove('selected'));
            document.getElementById('cat-'+state.cat).classList.add('selected');

            const showMode = ['explore','food','hotel','shopping'].includes(state.cat) && !(state.city==='boston' && state.cat==='hotel');
            document.getElementById('mode-control').style.display = showMode ? 'flex' : 'none';
            if(showMode) {
                if(state.cat === 'shopping') {
                    document.getElementById('opt-classic').innerText = "Souvenir Chic";
                    document.getElementById('opt-niche').innerText = "Stravagante";
                } else if(state.cat === 'hotel') {
                    document.getElementById('opt-classic').innerText = "Grand Luxe";
                    document.getElementById('opt-niche').innerText = "Boutique";
                } else {
                    document.getElementById('opt-classic').innerText = "Refined Classics";
                    document.getElementById('opt-niche').innerText = "New & Niche";
                }
                
                document.getElementById('opt-classic').className = state.mode === 'classic' ? 'mode-option active' : 'mode-option';
                document.getElementById('opt-niche').className = state.mode === 'niche' ? 'mode-option active' : 'mode-option';
                document.getElementById('mode-blob').style.left = state.mode === 'classic' ? '4px' : 'calc(50% + 2px)';
            }

            const feed = document.getElementById('feed');
            feed.innerHTML = '';

            if(state.cat === 'planner') {
                const museums = db.filter(i => i.cat === 'explore' && i.city === state.city);
                feed.innerHTML = `
                    <div class="planner-box">
                        <h2 class="text-2xl font-serif text-white mb-2">Concierge</h2>
                        <p class="text-sm text-gray-400 mb-4">Pianifica la mattinata a ${state.city.toUpperCase()}.</p>
                        <select id="planner-museum" class="planner-select">
                            ${museums.map(m => `<option value="${m.id}">${m.name} (${m.zone || ''})</option>`).join('')}
                        </select>
                        <button onclick="generatePlan()" class="w-full py-3 bg-[#BFEBFF] text-[#004D54] font-bold rounded-xl text-xs uppercase shadow-lg">Crea Piano</button>
                        <div id="planner-res"></div>
                    </div>`;
                return;
            }

            let data = db.filter(i => i.city === state.city && i.cat === state.cat);
            if(showMode) data = data.filter(i => i.mode === state.mode);

            if(data.length === 0) {
                feed.innerHTML = `<div class="text-center text-gray-500 mt-10">Nessun elemento trovato.</div>`;
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'glass-panel';
                card.id = `card-${item.id}`;
                if(item.isAlert) card.style.border = '1px solid #DB4F61';

                let extras = '';
                if(item.dish) extras = `<div class="mt-2 pl-2 border-l-2 border-[#BFEBFF]/30 text-xs text-gray-300">Must: ${item.dish} â€¢ ${item.cost}</div>`;
                
                if(item.hasRoutes) {
                    extras = `
                        <div class="time-btn-container">
                            <button class="time-btn" onclick="showRoute(${item.id}, '2h')">2 ORE</button>
                            <button class="time-btn" onclick="showRoute(${item.id}, '3h')">3 ORE</button>
                            <button class="time-btn" onclick="showRoute(${item.id}, '4h')">4 ORE</button>
                        </div>
                        <div id="list-${item.id}" class="artwork-list"></div>
                    `;
                }
                
                let btns = '';
                if(item.action === 'Chiama' || item.phone) btns += `<a href="tel:${item.phone}" class="btn-primary action-btn">Chiama</a>`;
                if(item.action === 'Mappa' || item.address) btns += `<button onclick="openTaxiCard('${item.name.replace("'","")}', '${item.address}')" class="btn-secondary action-btn ml-2">Mappa</button>`;
                if(item.link) btns += `<a href="${item.link}" target="_blank" class="btn-primary action-btn ml-2">Vedi</a>`;

                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex gap-3">
                            <div class="glass-icon"><i class="fa-solid ${item.icon}"></i></div>
                            <div>
                                <h3 class="card-title">${item.name}</h3>
                                ${item.zone ? `<p class="card-sub">${item.zone}</p>` : ''}
                            </div>
                        </div>
                    </div>
                    <p class="card-desc">${item.desc}</p>
                    ${extras}
                    ${!item.hasRoutes ? `<div class="mt-4 flex">${btns}</div>` : ''}
                `;
                feed.appendChild(card);
            });
        }

        function openTaxiCard(name, address) {
            document.getElementById('taxi-name').innerText = name;
            document.getElementById('taxi-address').innerText = address;
            document.getElementById('taxi-overlay').classList.add('active');
        }
        function closeTaxi() { document.getElementById('taxi-overlay').classList.remove('active'); }
        
        function toggleMeteo() {
            const txt = document.getElementById('meteo-txt');
            if(txt.innerText === 'Neve') txt.innerText = 'Sole';
            else txt.innerText = 'Neve';
        }
    </script>
</body>
</html>
